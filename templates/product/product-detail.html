{% extends 'base.html' %}
{% load static %}
{% block 'content' %}
<section id="product-detail" class="product-detail py-5">
  <div class="container" data-aos="fade-up">
      <div class="row g-4">
          <div class="col-md-6 text-center">
              <div id="product-carousel" class="carousel slide" data-bs-ride="carousel">
                  <div class="carousel-inner">
                      <div class="carousel-item active">
                          <img src="{{ object.image1.url }}" class="img-fluid rounded" alt="">
                      </div>
                      {% if object.image2 %}
                      <div class="carousel-item">
                          <img src="{{ object.image2.url }}" class="img-fluid rounded" alt="">
                      </div>
                      {% endif %}
                  </div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#product-carousel" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#product-carousel" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  </button>
              </div>
          </div>
          
           <div class="col-md-6">
              <div class="product-info">
                  <h2 class="product-title text-white">"{{object.title}}"</h2>
                  <p class="product-description text-white">{{ object.brief_description }}</p>

                  <div class="variable-single-item">
                    <span></span>
                
                  
                     
                      </div>
                    </div>
                  <p  class="category text-white">
                    {% for category in object.category.all %}
                        <strong>{{ category.title }}</strong>
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                  
                 
                  {% if object.is_discounted %}
                  <div class="price-box d-flex align-items-center gap-3">
                      <span class="price-label fw-bold">price: </span>
                      <span class="price-label fw-bold">{{object.get_price}}$ </span>
                      <span class="original-price text-pink-light text-decoration-line-through">{{object.price}}$</span>
                      {% else %}
                      <span class="discounted-price text-pink-dark fw-bold fs-4">{{object.get_price}}$</span>
                      {% endif %}
                  </div>
                  <div class="d-flex align-items-center mt-3">
                      <span class="me-2">Number:</span>
                      <input id="product-quantity" min="1" max="{{ object.stock }}" value="1" type="number" class="form-control" style="width: 70px; height: 30px; text-align: center; background-color: #ffb6c1;">
                  </div>

                  <div class="variable-single-item mt-3">
                    <span class="fw-bold">Color:</span>
                    <div class="product-variable-color d-flex flex-wrap gap-2 mt-2">
                        {% for color in object.colors.all %}
                        <label for="product-color-{{ color.id }}" class="color-label">
                            <input type="radio" name="product-color" id="product-color-{{ color.id }}" value="{{ color.id }}" class="d-none" {% if forloop.first %}checked{% endif %}>
                            <span class="product-color" style="background-color: {{ color.hex_code }};"></span>
                        </label>
                        {% endfor %}
                    </div>
                </div>     
                  <!-- دکمه‌های Wishlist و Add to Cart -->
                  <div class="action-buttons mt-4 d-flex gap-3">
                      {% if request.user.is_authenticated %}
                          <button id="nom" type="button" style="    background-color: #ffb6c1 !important;
    border-radius: 30px !important;
                          color: white !important;
                          border: none !important;" class="btn btn-outline-danger px-4" onclick="addToWishlist(this, `{{ object.id }}`)">
                              <i class="bi bi-heart"></i> Wishlist
                          </button>
                      {% endif %}
                   
                      <div class="product-add-to-cart-btn">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#modalAddcart"
                           onclick="addToCart('{{ object.id }}', event)">
                            + اضافه به سبد خرید
                        </a>
                    </div>
                    
                </div>
                  <!-- بخش نظرات -->
                  <div class="reviews mt-4">
                      <h4>Customer Reviews</h4>
                      <div class="default-form-box" >
                          <label for="rating">Rating:</label>
                          <select name="rating" id="rating" class="form-select mb-2 rating-dropdown" required style=" background-color: #ffb6c1; border-radius: 5px;">
                              <option selected class="rating-placeholder">Choose a rating</option>
                              <option value="5">⭐⭐⭐⭐⭐</option>
                              <option value="4">⭐⭐⭐⭐</option>
                              <option value="3">⭐⭐⭐</option>
                              <option value="2">⭐⭐</option>
                              <option value="1">⭐</option>
                          </select>
                      </div>
                      <div class="review-form mt-3">
                          <textarea class="form-control mb-2" placeholder="Write your review..."></textarea>
                          <button type="button" class="btn btn-dark">Submit Review</button>
                      </div>
                      <div class="review-list mt-3">
                          <div class="review p-3 border rounded mb-2">
                              <strong>John Doe</strong> - 
                              <span class="text-warning">★★★★☆</span>
                              <p>Great product! Really loved it.</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</section>


<style>
    /* استایل اصلی رنگ‌ها */
    .product-variable-color {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
    }
    .product-variable-color label {
        position: relative;
        width: 40px;
        height: 40px;
        cursor: pointer;
    }
    .product-variable-color input {
        display: none;
    }
    .product-variable-color .product-color {
        width: 100%;
        height: 100%;
        border: 2px solid transparent;
        border-radius: 50%;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* استایل رنگ انتخاب‌شده */
    .product-variable-color input:checked + .product-color {
        border: 3px solid black !important;
        position: relative;
    }
    .product-variable-color input:checked + .product-color::after {
        content: "✓";
        font-size: 18px;
        font-weight: bold;
        color: white;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    #nom:hover {
    background-color: #ff1493;
    color: white;
}

.product-detail {
    margin-top: 100px;
    margin-bottom: 100px;
}
    </style>

<script>

document.addEventListener("DOMContentLoaded", function () {
    new bootstrap.Carousel(document.querySelector("#product-carousel"), { interval: 3000, wrap: true });
});

// تابع گرفتن CSRF Token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// تابع افزودن محصول به سبد خرید
function addToCart(productId, event) {
    event.preventDefault();  // جلوگیری از رفتار پیش‌فرض لینک
    fetch('/cart/add/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ 'product_id': productId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("✅ محصول با موفقیت به سبد خرید اضافه شد!");
        } else {
            alert("❌ مشکلی پیش آمده است، لطفاً دوباره امتحان کنید!");
        }
    })
    .catch(error => {
        console.error("خطا در افزودن به سبد خرید:", error);
        alert("⚠️ مشکلی در ارتباط با سرور پیش آمد!");
    });
}
</script>


      
{% endblock 'content' %}
